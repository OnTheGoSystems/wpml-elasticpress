.unit-script:
    script:
        - >
            if [[ -f ./vendor/bin/phpunit ]] ; then
                if [[ -f ./.make/adjust-phpunit.sh ]] ; then
                    make adjust-phpunit
                fi
                if [[ -f ./tests/phpunit/phpunit.xml ]] ; then
                    ./vendor/bin/phpunit --configuration=./tests/phpunit/phpunit.xml --fail-on-warning
                else
                    ./vendor/bin/phpunit --fail-on-warning
                fi
            else
                echo "Unit tests skipped."
            fi

Unit <PHP>:
    stage: test
    extends:
        - .cache-pull
        - .unit-script
    when: on_success
    image: registry.otgs.work/infrastructure/docker-images/otgs/phpunit:5.7
    tags:
        - autoscale
    only:
        refs:
            - branches
    except:
        refs:
            - stable
            - bleeding

Unit <PHP 7.4>:
    stage: test
    extends:
        - .cache-pull
        - .unit-script
    allow_failure: true
    when: on_success
    image: registry.otgs.work/infrastructure/docker-images/wptest:7.4
    tags:
        - autoscale
    only:
        refs:
            - branches
    except:
        refs:
            - stable
            - bleeding

