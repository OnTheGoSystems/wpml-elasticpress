Unit <Jest>:
    variables:
        # I could not find how to pass the output name as a CLI argument, so I have to do that
        JEST_JUNIT_OUTPUT_NAME: "report-${CI_JOB_ID}.xml"
        REPORT_FILE_PATH: "report-${CI_JOB_ID}.xml"
    stage: test
    extends:
        - .cache-pull
        - .junit-report
    when: on_success
    image: node:11.10.1
    tags:
        - autoscale
    script:
        - >
            if [[ -f package.json && -f webpack.config.js && -f node_modules/jest/bin/jest.js && -f src/tests/setupTests.js ]] ; then
                if [[ -f node_modules/jest-junit/index.js ]] ; then
                    npm test -- --passWithNoTests --ci --reporters=default --reporters=jest-junit
                else
                    npm test -- --passWithNoTests
                fi
            else
                echo "Jest skipped."
            fi
    only:
        refs:
            - branches
    except:
        refs:
            - stable
            - bleeding
