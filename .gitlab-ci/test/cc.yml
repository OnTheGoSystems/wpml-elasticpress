CC Tests:
    stage: pre-flight
    when: manual
    image: registry.otgs.work/infrastructure/docker-images/git:latest
    tags:
        - autoscale
    variables:
        GIT_STRATEGY: none
        CC_PATH_WITH_NAMESPACE: 'wpml/codeception'
    script:
        - rm -rf ./codeception
        - git clone "ssh://git@git.onthegosystems.com:10022/wpml/codeception.git"
        - cd codeception
        - git checkout -b ${CI_COMMIT_REF_NAME} || git checkout ${CI_COMMIT_REF_NAME}
        - git push --set-upstream origin ${CI_COMMIT_REF_NAME}
        - curl -X POST "https://git.onthegosystems.com/api/v4/projects/wpml%2Fcodeception/pipeline?ref=${CI_COMMIT_REF_NAME}&private_token=${OTGS_CI_GITLAB_API_TOKEN}"
        - echo "Go to https://git.onthegosystems.com/wpml/codeception/pipelines to see your pipeline."
    only:
        refs:
            - branches
    except:
        refs:
            - tags
            - master
            - develop
            - stable
            - bleeding
