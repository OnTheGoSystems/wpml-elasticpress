Tag:
    extends:
        - .cache-pull
        - Branch
    script:
        - >
            if [[ -f webpack.config.js ]] ; then
                npm run build:prod
            fi
        - >
            if [[ -f composer.json ]] ; then
                composer install --no-dev --no-scripts --verbose
            fi
        - ./.make/deploy-copy.js -t ./${CI_PROJECT_NAME}
        - ./.make/deploy-update-version.js -t ./${CI_PROJECT_NAME} -r ${CI_COMMIT_TAG}
        - ./.make/deploy-cleanup.js -t ./${CI_PROJECT_NAME}
    artifacts:
        name: "${CI_PROJECT_NAME}.${CI_COMMIT_TAG}"
        expire_in: 5 yrs
        paths:
            - ${CI_PROJECT_NAME}
    except: []
    only:
        refs:
            - tags
